<!doctype html>
<html>
  <head>
    <title>test sockets</title>
    <script src="/socket.io/socket.io.js"></script>
    
  </head>
  <body>
    <div>
      <label>Name: </label>
      <input type="text" id="participant" />
    </div>
    <div>
      <span>Participants:</span>
      <span id="participants"></span>
    </div>
    
    <hr />
    <button id="start">Start Vote</button>
    <p id="cards">
      <button id="card1">1</button>
      <button id="card2">2</button>
      <button id="card3">3</button>
    </p>
    <p id="vote"></p>
    <p id="result"></p>

    <script>
        var socket = io({
          query: {
            roomId: '39944e90-c9f5-427e-a616-98c3f91b08bb'
          }
        });
        let participants = [];

        const card1El = document.getElementById("card1");
        const card2El = document.getElementById("card2");
        const card3El = document.getElementById("card3");
        const participantEl = document.getElementById("participant");

        socket.on("connect", () => {
          document.getElementById("participant").value = socket.id;
          document.getElementById("cards").childNodes.forEach(node => node.disabled = true);
        });

        socket.on("PARTICIPANT_LIST", data => {
          console.log(`received PARTICIPANT_LIST: ${data}`);
          participants = data;
          document.getElementById("participants").innerText = participants.map(p => p.name).join(", ");
        })

        socket.on("ESTIMATIONS_RESULT", data => {
          document.getElementById("result").innerText = `Result: ${JSON.stringify(data)}`;
          document.getElementById("cards").childNodes.forEach(node => node.disabled = true);
        });

        socket.on("ESTIMATION_STARTED", () => {
          document.getElementById("cards").childNodes.forEach(node => node.disabled = false);
          document.getElementById("result").innerText = '';
        });

        participantEl.addEventListener('change', (event) => {
          socket.emit("CHANGE_NAME", { name: event.target.value});
        })

        document.getElementById("start").addEventListener('click', () => {
          socket.emit("START_ESTIMATION");
        });

        card1El.addEventListener('click', () => {
          socket.emit("PLAY_CARD", { value: 1 });
          document.getElementById("vote").innerText = 'You voted: 1';
        });
  
        card2El.addEventListener('click', () => {
          socket.emit("PLAY_CARD", { value: 2 });
          document.getElementById("vote").innerText = 'You voted: 2';
        });

        card3El.addEventListener('click', () => {
          socket.emit("PLAY_CARD", { value: 3 });
          document.getElementById("vote").innerText = 'You voted: 3';
        });
      </script>
  </body>
</html>